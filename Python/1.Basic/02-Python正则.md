<!-- 
title: 02-Python正则
sort: 
--> 

## 描述字符

- 单个字符

  > 单个字符可直接输入
  >
  > `\`：转义
  >
  > `\d`：单个随机数字
  >
  > `\w`：单个随机字母
  >
  > `\s`：单个空格
  >
  > 大写即为非x
  >
  > `.`：任意字符
  >
  > `[]`匹配[]中的单词
  >
  > 还可以指定范围`[a-g0]`

- 多字符匹配

  > `任意字符`：匹配所有
  >
  > `*`：任意数量字符（包括0个）
  >
  > `?`：0或1个
  >
  > `+`：至少一个
  >
  > ​	`[]+`：多次匹配[]中的字符
  >
  > `{m}`：匹配一个字符出现m次
  >
  > ​	`[0-9]{4}`：匹配四次数字
  >
  > `{n,m}`：n-m个字符
  >
  > ​	`\w{4,10}`：4-10为数字
  
- 其他

  > `^$`开头与结尾
  >
  > `^`：在[]中则为取反
  >
  > `\\num`：引用()中的分组
  >
  > `(?P<name>[a-zA-Z0-])`：设置别名
  >
  > `(?P=name)`：使用别名
  
- 整理

  | 元字符 | 描述                                                   |
  | ------ | ------------------------------------------------------ |
  | .      | 匹配除换行符以外的任意字符。                           |
  | [ ]    | 字符类，匹配方括号中包含的任意字符。                   |
  | [^ ]   | 否定字符类。匹配方括号中不包含的任意字符               |
  | *      | 匹配前面的子表达式零次或多次                           |
  | +      | 匹配前面的子表达式一次或多次                           |
  | ?      | 匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。 |
  | {n,m}  | 花括号，匹配前面字符至少 n 次，但是不超过 m 次。       |
  | (xyz)  | 字符组，按照确切的顺序匹配字符xyz。                    |
  | \|     | 分支结构，匹配符号之前的字符或后面的字符。             |
  | \      | 转义符允许你匹配保留字符 `[ ] ( ) { } . * + ? ^ $ \ |` |
  | ^      | 匹配行的开始                                           |
  | $      | 匹配行的结束                                           |
  
- 字符集

```
"[Tt]he" => The car parked in the garage.	# 匹配T/t
```


- 重复

```
"[a-z]*" => The car parked in the garage #21.	# car parked in the garage
```

## 断言

- 用于匹配但不存在与结果之中

  | 符号 | 描述         |
  | ---- | ------------ |
  | ?=   | 正向先行断言 |
  | ?!   | 负向先行断言 |
  | ?<=  | 正向后行断言 |
  | ?<!  | 负向后行断言 |

```python
"(T|t)he(?=\sfat)" 			# 匹配后方跟着fat的the
"(T|t)he(?!\sfat)"			# 匹配后方没有fat的the
"(?<=(T|t)he\s)(fat|mat)"	# 获取挨着the的所有fat/mat
"(?<!(T|t)he\s)(cat)"		# 获取不挨着the的所有cat
```


## 标记

| 标记 | 描述                   |
| ---- | ---------------------- |
| /g   | 全局搜索               |
| /i   | 不区分大小写           |
| /.   | 除换行符外的所有字符   |
| /m   | 多行匹配 /.fzf(.)?$/gm |

## 常用正则表达式

- **正整数**: `^\d+$`
- **负整数**: `^-\d+$`
- **电话号码**: `^+?[\d\s]{3,}$`
- **电话代码**: `^+?[\d\s]+(?[\d\s]{10,}$`
- **整数**: `^-?\d+$`
- **用户名**: `^[\w\d_.]{4,16}$`
- **字母数字字符**: `^[a-zA-Z0-9]*$`
- **带空格的字母数字字符**: `^[a-zA-Z0-9 ]*$`
- **密码**: `^(?=^.{6,}$)((?=.*[A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z]))^.*$`
- **电子邮件**: `^([a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4})*$`
- **IPv4 地址**: `^((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))*$`
- **小写字母**: `^([a-z])*$`
- **大写字母**: `^([A-Z])*$`
- **网址**: `^(((http|https|ftp):\/\/)?([[a-zA-Z0-9]\-\.])+(\.)([[a-zA-Z0-9]]){2,4}([[a-zA-Z0-9]\/+=%&_\.~?\-]*))*$`
- **VISA 信用卡号码**: `^(4[0-9]{12}(?:[0-9]{3})?)*$`
- **日期 (MM/DD/YYYY)**: `^(0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])[- /.](19|20)?[0-9]{2}$`
- **日期 (YYYY/MM/DD)**: `^(19|20)?[0-9]{2}[- /.](0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])$`
- **万事达信用卡号码**: `^(5[1-5][0-9]{14})*$`

## **精确匹配**

- 使用[]表示范围
  > 可在[]后方加入匹配字符用于扩展
  >
  > - `[a-zA_Z\_][0-9a-zA-Z\_]{1-20}`：python中的合法变量
  >
  > `(p|P)ython`：匹配python
  >
  > `^ $`：匹配开头或结尾

## RE库

- 使用正则表达式

  > 可直接传入字符串，但转义符需要双写
  >
  > 或者：`r'fzf\d{0.3}'`

- 判断是否匹配

  > `re.match(re,str)`
  >
  > 返回`.group()`

  ```python
  test = '用户输入的字符串'
  if re.match(r'正则表达式', test):
    print('ok')
  else:
    print('failed')
  ```

- **切分字符串**

  > `re.split(r'\s+', a b                                                                                                                               
  >
  > 强于`str.split()`

- 分组

  > 使用`()`分组
  >
  > 可以使用`group`提取
  >
  > ```python
  > m = re.match(r'^(\d{3})-(\d{3,8})$', '010-12345')
  > 
  > m.groups()
  > ('010', '12345')
  > m.group(0)	# 原始字符串
  > '010-12345'
  > m.group(1)
  > '010'
  > m.group(2)
  > '12345'
  > ```
  >
  
- 匹配方式

  > 默认为贪婪匹配
  >
  > 添加？可以尽量少匹配

- **编译方式**

  > 可以预编译表达时，提高效率
  >
  > `cop = re.compile(re)`

### 高级用法

```python
# 搜索一次，从任意位置匹配
# match之从开头匹配，不满足则None
re.search('\d{3}', "高考分数：721")
#搜索全部，返回列表
re.findall('\d{3}', "高考分数：721 语文：142 数学：148")
# 替换
re.sub('RE', 'New Content', 'Str')
re.sub('\d{3}', '100', "高考分数：721 语文：142 数学：148")
```

