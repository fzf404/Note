(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{809:function(n,o){n.exports="\x3c!--\ntitle: 06-32位保护模式\nsort:\n--\x3e\n\n## 8086 寄存器\n\n![img](https://img-1257284600.cos.ap-beijing.myqcloud.com/2021/v2-706b8593baced5da11a556f4c300f226_b.jpg)\n\n## GDT\n\n> 将段寄存器映射到内存中来提供 32 位地址。\n>\n> 段寄存器更名为段选择子\n\n![img](https://img-1257284600.cos.ap-beijing.myqcloud.com/2021/v2-a95b7148b2767b12fe63da93f43d08bb_b.jpg)\n\n### GDTR 寄存器\n\n> 指定 GDT 的地址，规定 GDT 的大小\n>\n> `lgdt`\n\n```assembly\nCreatDPT:\n    lgdt [GDTsize]  ; GDP的地址和大小写入GDTR\n\n    ; 保护模式描述符\n    mov dword [es:0x00], 0x00\n    mov dword [es:0x04], 0x00\n    mov dword [es:0x08], 0x8000ffff\n    mov dword [es:0x0c], 0x00409800\n    mov dword [es:0x10], 0x0000ffff\n    mov dword [es:0x14], 0x00c09200\n    mov dword [es:0x18], 0x00007a00\n    mov dword [es:0x1c], 0x00409600\n    ret\n\nnext:\n    in al,0x92    ; 打开a20地址线\n    or al,0000_0010B\n    out 0x92,al\n    cli         ; 禁止中断\n    mov eax,cr0 ; 打开保护模式开关\n    or eax,1\n    mov cr0,eax\n\n    ; 进入保护模式\n    jmp dword 0x0008:inprotectmode-512  ; 16位的描述符选择子：32位偏移;这里需要扣除掉512B的MBR偏移量\n\n[bits 32]\ninprotectmode:\n    mov ax,00000000000_10_000B          ; 加载数据段选择子(0x10)\n    mov ds,ax\n    ; 验证保护模式下的数据段设置正确\n    mov byte [0xb8000+20*160+0x00],'P'  ;屏幕第20行开始显示\n    mov byte [0xb8000+20*160+0x01],0x0c\n\n   ; 通过堆栈操作,验证保护模式下的堆栈段设置正确\n    mov ax, 00000000000_11_000B ; 加载堆栈段选择子(0x11)\n    mov ss, ax                  ; 7a00-7c00为此次设计的堆栈区\n    mov esp,0x7c00              ; 7c00固定地址为栈底，\n                                ; 7a00为栈顶的最低地址（通过载堆栈段选择子的段界限值设置）\n    mov  ebp,esp                ; 保存堆栈指针\n    push byte '$'               ; 压入立即数\n\n    sub ebp,4\n\n    cmp ebp,esp ; 判断ESP是否减4\n    jnz over3    ; 如果堆栈工作正常则打印出pop出来的值和其它字符\n\n    pop eax\n\n    mov byte [0xb8000+22*160+0x00],'S'\n    mov byte [0xb8000+22*160+0x01],0x0c\n    mov byte [0xb8000+22*160+0x02],al     ;打印出pop出来的值\n    mov byte [0xb8000+22*160+0x03],0x0c\n\nover3:\n    jmp $\n```\n\n![image-20210204214823035](https://img-1257284600.cos.ap-beijing.myqcloud.com/2021/image-20210204214823035.png)\n\n## 32 位下的显示\n\n![img](https://img-1257284600.cos.ap-beijing.myqcloud.com/2021/v2-b349937ce14e9a561dd2b8a705aebb69_b.jpg)\n"}}]);