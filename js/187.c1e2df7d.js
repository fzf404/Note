(window.webpackJsonp=window.webpackJsonp||[]).push([[187],{815:function(n,t){n.exports='\x3c!--\ntitle: 45-WebAssembly\nsort:\n--\x3e\n\n> [编译器 SDK](https://github.com/emscripten-core/emscripten)\n>\n> [在线编译](http://mbebenita.github.io/WasmExplorer/)\n\n### 安装\n\n```bash\ngit clone https://github.com/emscripten-core/emsdk.git\n./emsdk install latest\n./emsdk activate latest\n\n# h\nsource /opt/emsdk/emsdk_env.fish\n```\n\n## 例子\n\n> 计算斐波那契数列\n\n### CPP\n\n```c++\n#include <iostream>\n#include <ctime>\n\nusing namespace std;\n\nint fib(int x)\n{\n\tif (x <= 0)\n\t\treturn 0;\n\tif (x <= 2)\n\t\treturn 1;\n\treturn fib(x - 1) + fib(x - 2);\n}\n\nint main()\n{\n\n\tint t0, t1;\n\n\tt0 = clock();\n\tfib(40);\n\tt1 = clock();\n\n\tcout << (t1 - t0) / 1000 << "ms" << endl;\n\n\treturn 0;\n}\n\n// -O0 385ms\n// -O1 253ms\n// -O2/3 197ms\n```\n\n### JS\n\n```js\nconst fib = (x) => {\n  if (x <= 0) return 0;\n  if (x <= 2) {\n    return 1;\n  }\n  return fib(x - 1) + fib(x - 2);\n};\nconsole.time("Fib Time");\nlet result = fib(40);\nconsole.timeEnd("Fib Time");\n\n// Fib Time: 640ms\n```\n\n### cc\n\n```c++\nextern "C"\n{\n\tint fib(int x)\n\t{\n\t\tif (x <= 0)\n\t\t\treturn 0;\n\t\tif (x <= 2)\n\t\t\treturn 1;\n\t\treturn fib(x - 1) + fib(x - 2);\n\t}\n}\n```\n\n### 编译\n\n```\nemcc fib.cpp -o fib.js\nemcc fib.cc -o fib -s EXPORTED_FUNCTIONS=\'["_fib"]\' -O2\n```\n\n### 浏览器使用\n\n```js\nfetch("./fib.wasm")\n  .then((res) => res.arrayBuffer())\n  .then((bytes) => WebAssembly.compile(bytes))\n  .then((mod) => {\n    const instance = new WebAssembly.Instance(mod);\n    const fib = instance.exports.fib;\n    console.time("Fib Time");\n    let result = fib(40);\n    console.timeEnd("Fib Time");\n  });\n// Fib Time: 370ms\n```\n'}}]);