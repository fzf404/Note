(window.webpackJsonp=window.webpackJsonp||[]).push([[334],{962:function(n,s){n.exports='\x3c!--\ntitle: 10-扫雷注入实例\nsort:\n--\x3e\n\n## 过程\n\n`C:\\WINDOWS\\system\\winmine.exe`\n\n1. 查找主窗口\n\n> 查找->窗口\n\n2. 设置 ClassProc 断点\n\n> - 窗口->跟随 ClassProc\n>\n> 这时进入窗口点击事件处理函数\n\n```c\nLRESULT CALLBACK WindowProc(\n    HWND hwnd,\t// 发送方的窗口句柄\n    UINT msg,\t// 消息id，即消息的种类\n    WPARAM wparam,\t// 详细信息\n    LPARAM lparam)\t// 详细信息\n```\n\n> - 在第二个参数后设置断点，筛选消息种类\n>\n> 右键->断点->条件(Shift+F2)：`edx==WM_COMMAND`\n\n![image-20210428224637995](https://img-1257284600.cos.ap-beijing.myqcloud.com/2021/20210428224646.png)\n\n3. 查找菜单选项对应的参数`EBP+10`\n\n> 初级：0x0209\n>\n> 中级：0x020A\n>\n> 高级：0x020B\n\n![image-20210429151417779](https://img-1257284600.cos.ap-beijing.myqcloud.com/2021/20210429151425.png)\n\n4. 使用 CE 查找地址\n\n> 剩余雷数：`0x01005194`\n>\n> 累计时间：`0x0100579C`\n\n5. 注入代码\n\n```assembly\npush 0\t\t\t; lparam\npush 0x209\t\t; wparam\npush 0x111\t\t; msg\npush 0x0009013A\t; hwnd\ncall 0x01001BC9\t; 调用处理函数\n```\n\n![image-20210429152827679](https://img-1257284600.cos.ap-beijing.myqcloud.com/2021/20210429152858.png)\n\n6. CE 查内存\n\n> 雷区：`0x01005361 - 0x01005661`\n>\n> `char board[24][32]`\n>\n> 宽度地址：`0x01005334`\n>\n> 高度地址：`0x01005338`\n>\n> 雷数地址：`0x01005330`\n\n![](https://img-1257284600.cos.ap-beijing.myqcloud.com/2021/20210504112952.png)\n\n## 调用 WinAPI 开发外挂\n\n```cpp\n#include "windows.h"\n\nHWND hWnd;    // 窗口句柄\nDWORD pid;    // 进程ID\nHANDLE hProcess;    // 进程句柄\n\n// 获得窗口句柄\nhWnd = ::FindWindow(NULL,"扫雷");\nif( !hWnd ){\n    QMessageBox::critical(this, "提示", "游戏未打开");\n    return;\n}\n\n// 获得进程ID并获得句柄\nGetWindowThreadProcessId(hWnd,&pid);\nhProcess = ::OpenProcess(PROCESS_ALL_ACCESS,FALSE,pid);\nif( !hProcess ){\n    QMessageBox::critical(this, "提示", "游戏进程打开失败");\n    return;\n}\n\n// 触发初、中、高级菜单\n::SendMessageA(hWnd,WM_COMMAND,0x209,0);\n\n// 读内存\nint mines_num;\n::ReadProcessMemory(hProcess,(LPCVOID)0x01005194,&mines_num,sizeof(mines_num),&pid);\n\n// 写内存\nint new_mines_num = new_mines.toInt();\n::WriteProcessMemory(hProcess,(LPVOID)0x01005194,&new_mines_num,sizeof(new_mines_num),&pid);\n\n// 模拟点击\n::PostMessage(hWnd, WM_LBUTTONDOWN, MK_LBUTTON, *(int *)boxXY);\n::PostMessage(hWnd, WM_LBUTTONUP, 0, *(int *)boxXY);\n```\n\n![](https://img-1257284600.cos.ap-beijing.myqcloud.com/2021/20210504112935.png)\n'}}]);