(window.webpackJsonp=window.webpackJsonp||[]).push([[180],{808:function(n,o){n.exports="\x3c!--\ntitle: 05-图形化\nsort:\n--\x3e\n\n> 如何拥有图形化界面?\n\n![image-20210104223703406](https://img-1257284600.cos.ap-beijing.myqcloud.com/2020/20210104223710.png)\n\n## 窗口\n\n> 调用 10h-06h 中断\n\n```asm\n; 特定位置显示窗口\n%macro crtWin  6        ; 建立窗口,行数-前景:背景色-左上角YX-右上角YX\n    mov ah, 06h\n    mov al, %1\n    mov bh, %2\n    mov ch, %3\n    mov cl, %4\n    mov dh, %5\n    mov dl, %6\n    int 10h\n%endmacr\n\n; 特定位置显示字符\n%macro printStr  4      ; 打印字符, Num-Attr-Row-Column\n    mov cx, %1       ; 字符数量\n    mov ah, 13h\n    mov al, 01h      ; 显示属性->BL, 光标位置改变\n    mov bh, 0        ; 页\n    mov bl, %2       ; 属性\n    mov dh, %3       ; 行\n    mov dl, %4       ; 列\n    int 10h\n%endmacr\n```\n\n## 绘图\n\n> 调用 10h-0ch\n\n![image-20210108200400585](https://img-1257284600.cos.ap-beijing.myqcloud.com/2020/20210108200408.png)\n\n```asm\njmp start\n\nstart:\n  call   windows    ; 绘图\n  ; 带返回值中断\n  mov ah,4ch\n  int 21h\n\nwindows:\n  call setmode\n  call alllines    ; 打印背景\n  call win1\n  call win2\n  call win3\n  call win4\n  ret\n\n\nsetmode:\n  mov  bx,0x4105    ; 设置图形模式：1024×768 256色\n  mov  ax,0x4f02\n  int  10h\n  ret\n\nalllines:\n  mov  dx,0        ; 列计数\ngoon2:\n  mov  cx,0       ; 行计数\n  call oneline\n  inc  dx\n  cmp  dx,767\n  jne  goon2\n  ret\n\noneline:           ; 第dx行画水平线\n  ;mov cx,0        ; x坐标\n  ;mov dx,0        ; y坐标\n  mov al,00010001b     ; 写入像素 xxxxARGB\n  mov ah,0ch       ;\ngoon:\n  inc cx\n  cmp cx,1023\n  int 10h\n  jne goon\n  ret\n\nwin1:\n  mov dx,200      ; 200行开始\nlinew1:\n  mov cx,300      ; 300列\ngoonw1:\n  mov al,0100b     ;颜色\n  mov ah,0ch       ;写入点像\n  inc cx\n  int 10h\n  cmp cx,500      ; 至500\n  jne goonw1\n  inc dx\n  cmp dx,400      ; 至400\n  jne linew1\n  ret\n\nwin2:\n  mov dx,200\nlinew2:\n  mov cx,520\ngoonw2:\n  mov al,0010b\n  mov ah,0ch\n  inc cx\n  int 10h\n  cmp cx,720\n  jne goonw2\n  inc dx\n  cmp dx,400\n  jne linew2\n  ret\n\nwin3:\n  mov dx,420\nlinew3:\n  mov cx,300\ngoonw3:\n  mov al,0001b\n  mov ah,0ch\n  inc cx\n  cmp cx,500\n  int 10h\n  jne goonw3\n  inc dx\n  cmp dx,620\n  jne linew3\n  ret\n\nwin4:\n  mov dx,420\nlinew4:\n  mov cx,520\ngoonw4:\n  mov al,0110b\n  mov ah,0ch\n  inc cx\n  cmp cx,720\n  int 10h\n  jne goonw4\n  inc dx\n  cmp dx,620\n  jne linew4\n  ret\n```\n\n## 调用显存\n\n> 调用显卡创建调色板端口\n>\n> 写入`0xa000`\n\n![image-20210108214311169](https://img-1257284600.cos.ap-beijing.myqcloud.com/2020/20210108214311.png)\n\n```asm\ncolorfuncport equ 3c8h   ; 设置调色板功能端口\ncolorsetport equ 3c9h    ;设置调色板颜色端口\ndisplayadd equ 0xa000    ;图像模式显存起始地址\n\n\ncall  setmode     ; 显示模式 320*200\ncall  backgroud   ; 背景色设置\ncall  colorset\ncall  win1\ncall  win2\ncall  win3\ncall  win4\n; call drawimg\nmov   ax,0ch\nint   21h\njmp   $\n\nsetmode:\n  mov ah,0\n  mov al,13h\n  int 10h\n  ret\n\nsetmode2:         ; 1024*768\n  mov AX,4F02H\n  mov bx,4105H\n  int 10h\n  ret\n\nbackgroud:\n  mov dx, colorfuncport\n  mov al, 0               ; 建调色板索引0号\n\n  ; 外设的操作通过专门的端口读写指令来完成\n  out dx,al               ; Out: al的值写入显卡调色板功能端口\n\n  mov dx, colorsetport    ;设置黑灰色背景\n  mov al,8                ; R分量\n  out dx,al\n  mov al,8                ; G分量\n  out dx,al\n  mov al,8               ; B分量\n  out dx,al\n  ret\n\ncolorset:                 ; 显示色设置\n  mov dx, colorfuncport\n  mov al, 1               ; 建调色板索引1号\n  out dx, al\n  mov dx, colorsetport    ;设置红色调色板\n  mov al,32\n  out dx,al\n  mov al,0\n  out dx,al\n  mov al,0\n  out dx,al\n\n  mov dx, colorfuncport\n  mov al, 2                 ; 建调色板索引2号\n  out dx,al\n  mov dx,  colorsetport     ;设置蓝色调色板\n  mov al,0\n  out dx,al\n  mov al,0\n  out dx,al\n  mov al,32\n  out dx,al\n\n  mov dx,  colorfuncport\n  mov al, 3                 ;建调色板索引3号\n  out dx,al\n  mov dx,  colorsetport     ;设置绿色\n  mov al,0\n  out dx,al\n  mov al,32\n  out dx,al\n  mov al,0\n  out dx,al\n\n  mov dx, colorfuncport\n  mov al, 4                 ;建调色板索引4号\n  out dx,al\n\n  mov dx,  colorsetport     ;设置黄色\n  mov al,32\n  out dx,al\n  mov al,32\n  out dx,al\n  mov al,0\n  out dx,al\n\n  ret\n\n\ndrawimg:           ; 满屏画同一颜色\n  mov bl,4\n  mov ax,displayadd\n  mov es,ax\n  mov cx,0xffff    ; 设置距离\n  mov di,0\n\nnextpoint:\n  mov  [es:di],bl   ; 调色板颜色索引送往显存地址\n  inc  di\n  loop nextpoint\n  ret\n\nwin1:\n  mov bl,1              ; 填充颜色\n  mov dx,50             ; 起始行\n  mov ax,320*50/10h     ; 起始行前像素点数量\n  add ax,displayadd\n  mov es,ax\nwin1line:\n  mov cx,50           ; 矩形长度 es:di计数\n  mov di,100          ; 起始列\nwin1point:\n  mov  [es:di],bl     ; 调色板颜色索引送往显存地址\n  inc di\n  loop win1point\n  inc dx\n  mov ax,es\n  add ax,0x14         ; 显卡内存每一行增加一次es段地址   320*x+y 320=140h\n  mov es,ax\n  cmp dx,100          ; 矩形高度\n  jne win1line\n  ret\n\nwin2:\n  mov bl,2\n  mov dx,110         ; 起始行\n  mov ax,320*110/10h\n  add ax,displayadd\n  mov es,ax\n  win2line:\n  mov cx,50\n  mov di,100          ; 起始列\n  win2point:\n  mov  [es:di],bl\n  inc di\n  loop win2point\n  inc dx\n  mov ax,es\n  add ax,0x14\n  mov es,ax\n  cmp dx,160\n  jne win2line\n  ret\n\nwin3:\n  mov bl,3\n  mov dx,50         ; 起始行\n  mov ax,320*50/10h\n  add ax,displayadd\n  mov es,ax\n  win3line:\n  mov cx,50\n  mov di,160         ; 起始列\n  win3point:\n  mov  [es:di],bl\n  inc di\n  loop win3point\n  inc dx\n  mov ax,es\n  add ax,0x14\n  mov es,ax\n  cmp dx,100\n  jne win3line\n  ret\n\nwin4:\n  mov bl,4\n  mov dx,110         ; 起始行\n  mov ax,320*110/10h\n  add ax,displayadd\n  mov es,ax\n  win4line:\n  mov cx,50\n  mov di,160         ; 起始列\n  win4point:\n  mov  [es:di],bl\n  inc di\n  loop win4point\n  inc dx\n  mov ax,es\n  add ax,0x14\n  mov es,ax\n  cmp dx,160\n  jne win4line\n  ret\n```\n"}}]);