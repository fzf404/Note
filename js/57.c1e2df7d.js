(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{685:function(e,n){e.exports='\x3c!--\ntitle: 调用摄像头\nsort:\n--\x3e\n\n## 例子\n\n```js\n// 展示用标签\nlet showLabel = document.querySelector(".show");\nlet recordLabel = document.querySelector("a");\nlet choiceLabel = document.querySelector(".choice");\n// 拍照绘图\nlet canvas = document.createElement("canvas");\nlet context = canvas.getContext("2d");\nlet recorder;\n// 默认配置\nlet showOpt = {\n  audio: false,\n  video: true,\n};\n\n// 获取媒体设备列表\nlet getMedia = () => {\n  navigator.mediaDevices\n    .enumerateDevices()\n    .then((devices) => {\n      devices.forEach((device) => {\n        // 判断设备是否为视频类型\n        if (device.kind === "videoinput") {\n          // 增加select标签\n          choiceLabel.insertAdjacentHTML(\n            "beforeend",\n            `<option value="${device.deviceId}">${device.label}</option>`\n          );\n        }\n      });\n    })\n    .catch((err) => {\n      console.log(`${err.name}:${err.message}`);\n    });\n};\n\n// 展示\nlet showVideo = () => {\n  navigator.mediaDevices\n    .getUserMedia(showOpt)\n    .then((mediaStream) => {\n      showLabel.srcObject = mediaStream;\n      showLabel.onloadedmetadata = (e) => {\n        showLabel.play();\n      };\n    })\n    .catch((err) => {\n      console.log(`${err.name}:${err.message}`);\n    });\n};\n\n// 切换摄像头\nlet chVideo = () => {\n  // 获取列表元素的id值\n  let deviceId = choiceLabel.value;\n  showOpt = {\n    audio: false,\n    video: {\n      optional: [\n        {\n          sourceId: deviceId,\n        },\n      ],\n    },\n  };\n  showVideo();\n};\n\n// 拍照\nlet takePhoto = () => {\n  //创建canvas标签\n  canvas.width = showLabel.videoWidth;\n  canvas.height = showLabel.videoHeight;\n  //利用video画图\n  context.drawImage(showLabel, 0, 0);\n  //将canvas图像转换为base64字符串，设置格式以及压缩比例\n  let image = canvas.toDataURL("image/jpeg", 90 / 100);\n\n  // 下载标签更新并点击\n  recordLabel.href = image;\n  recordLabel.click();\n};\n\n// 录像\nlet recordVideo = () => {\n  // 转换Opt为局部变量\n  let recordOpt = showOpt;\n  // 开启音频录制\n  recordOpt.audio = true;\n  console.log("start");\n  // 获取音视频流\n  navigator.mediaDevices\n    .getUserMedia(recordOpt)\n    .then((mediaStream) => {\n      // 初始化记录对象\n      recorder = new MediaRecorder(mediaStream);\n      recorder.ondataavailable = (e) => {\n        let recordData = e.data;\n        recordLabel.href = URL.createObjectURL(recordData);\n      };\n      recorder.start();\n      // 按钮变色\n      document.getElementsByClassName("start")[0].classList.add("disable");\n      document.getElementsByClassName("stop")[0].classList.remove("disable");\n    })\n    .catch((err) => {\n      console.log(`${err.name}:${err.message}`);\n    });\n};\n\n// 停止录制\nlet stopVideo = () => {\n  recorder.stop();\n  console.log("stop!");\n  // 修改按钮颜色\n  document.getElementsByClassName("stop")[0].classList.add("disable");\n  document.getElementsByClassName("start")[0].classList.remove("disable");\n  // 延时加载\n  setTimeout(() => recordLabel.click(), 1000);\n};\n\n// 退出\nlet exit = () => {\n  window.utools.outPlugin();\n};\n\n// 执行\ngetMedia();\nshowVideo();\n```\n'}}]);